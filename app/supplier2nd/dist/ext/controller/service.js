const cds=require("@sap/cds");module.exports=cds.service.impl(async function(){let{Invoice1:t,Invoice2:o,Invoice3:e,Draft_child:n,Draft_child2:a,Rejected_child2:i,Submitted_child2:s,Approved_child2:_,sub:d,Currency:r,Document_type:c,vendor_tds:m,sub12:y,New:u,New_child:b,Submitted:p,Submitted_child:l,Approved:v,Approved_child:g,vendor_payment_term:f,material_gst_per:E}=this.entities;const h=await cds.connect.to("iflow");var T=true;var S=true;var w=true;this.on("getPdfUrl",async o=>{const e=await SELECT`file_link`.from(t);return e});this.on("getPdfUrlApproved",async t=>{const e=await SELECT`file_link`.from(o);return e});this.on("getPdfUrlSubmitted",async t=>{const o=await SELECT`file_link`.from(d);return o});const x={};T=true;this.before("READ",t,async o=>{T=true;try{var e=false;const n=await SELECT.from(t);invoiceNo1=n[0].invoice_no;if(o.params[0].invoice_no!=null){cds.tx(o).run(DELETE(t));var e=true;const n=o.params[0].invoice_no;const a=`/dev/fetch-invoice?invoice_no=${n}&userid=einvoiceportal@gmail.com&edit=X`;const i=await h.post(a);const s=i.body;const _=[];_.push({invoice_no:i.body.invoice_no,INVOICE_FILE:"Open",payment_terms:i.body.payment_terms,irn:i.body.irn,ref_po_num:i.body.ref_po_num,gstin:i.body.gstin,doc_type_desc:i.body.doc_type_desc,user_invoice_id:i.body.user_invoice_id,invoice_date:i.body.invoice_date,posting_date:i.body.posting_date,baseline_date:i.body.baseline_date,supplier_id:i.body.supplier_id,payment_method:i.body.payment_method,company_code:i.body.company_code,currency:i.body.currency,department_name:i.body.department_name,gl_account:i.body.gl_account,cost_center:i.body.cost_center,internal_order:i.body.internal_order,taxable_amount:i.body.taxable_amount,adjustment:i.body.adjustment,amount:i.body.amount,tcs:i.body.tcs,tds_per:i.body.tds_per,tds_tot_amt:i.body.tds_tot_amt,discount_per:i.body.discount_per,total_discount_amount:i.body.total_discount_amount,cgst_tot_amt:i.body.cgst_tot_amt,sgst_tot_amt:i.body.sgst_tot_amt,igst_tot_amt:i.body.igst_tot_amt,file_link:i.body.files[0]?.file_link||"NA",totaltaxamount:(()=>{if(i.body.igst_tot_amt===0){return`CGST: ${i.body.cgst_tot_amt}, SGST: ${i.body.sgst_tot_amt}`}else{return`IGST: ${i.body.igst_tot_amt}`}})()});await cds.tx(o).run(INSERT.into(t).entries(_))}var e=false;return o}catch(n){if(e){o.error(500,n.message)}try{var e=false;const n=await SELECT.from(t);invoiceNo1=n[0].invoice_no;if(o.query.SELECT.where[2].val!=null){cds.tx(o).run(DELETE(t));var e=true;const n=o.query.SELECT.where[2].val;const a=`/dev/fetch-invoice?invoice_no=${n}&userid=einvoiceportal@gmail.com&edit=X`;const i=await h.post(a);const s=i.body;const _=[];_.push({invoice_no:i.body.invoice_no,INVOICE_FILE:"Open",payment_terms:i.body.payment_terms,irn:i.body.irn,ref_po_num:i.body.ref_po_num,gstin:i.body.gstin,doc_type_desc:i.body.doc_type_desc,user_invoice_id:i.body.user_invoice_id,invoice_date:i.body.invoice_date,posting_date:i.body.posting_date,baseline_date:i.body.baseline_date,supplier_id:i.body.supplier_id,payment_method:i.body.payment_method,company_code:i.body.company_code,currency:i.body.currency,department_name:i.body.department_name,gl_account:i.body.gl_account,cost_center:i.body.cost_center,internal_order:i.body.internal_order,taxable_amount:i.body.taxable_amount,adjustment:i.body.adjustment,amount:i.body.amount,tcs:i.body.tcs,tds_per:i.body.tds_per,tds_tot_amt:i.body.tds_tot_amt,discount_per:i.body.discount_per,total_discount_amount:i.body.total_discount_amount,cgst_tot_amt:i.body.cgst_tot_amt,sgst_tot_amt:i.body.sgst_tot_amt,igst_tot_amt:i.body.igst_tot_amt,file_link:i.body.files[0]?.file_link||"NA"});await cds.tx(o).run(INSERT.into(t).entries(_))}var e=false;return o}catch(n){if(e){o.error(500,n.message)}try{if(T){cds.tx(o).run(DELETE(t));const e=await h.get("/dev/fetch-invoice?tabname=draft&pageno=1&nooflines=10&userid=einvoiceportal@gmail.com");const n=e.body.invoices;const a=[];n.forEach(t=>{a.push({INVOICE_FILE:t.invoice_files.length||"NA",invoice_no:t.invoice_no,user_invoice_id:t.user_invoice_id,supplier_name:t.supplier_name||"NA",invoice_date:t.invoice_date,working_person:t.working_person,modified_date:t.modified_date})});await cds.tx(o).run(INSERT.into(t).entries(a))}return o}catch(t){o.error(500,t.message)}}}});var I=true;this.before("READ",n,async t=>{try{if(I){let o=t.params[0].invoice_no;console.log(o);const e=[];const a=[];const i=await h.post(`/dev/fetch-invoice?invoice_no=${o}&userid=einvoiceportal@gmail.com&edit=X`);cds.tx(t).run(DELETE(n));const s=i.body.items;e.push({invoice_no:i.body.invoice_no,payment_terms:i.body.payment_terms,irn:i.body.irn,ref_po_num:i.body.ref_po_num,gstin:i.body.gstin,doc_type_desc:i.body.doc_type_desc,user_invoice_id:i.body.user_invoice_id,invoice_date:i.body.invoice_date,posting_date:i.body.posting_date,baseline_date:i.body.baseline_date,supplier_id:i.body.supplier_id,payment_method:i.body.payment_method,company_code:i.body.company_code,currency:i.body.currency,department_name:i.body.department_name,gl_account:i.body.gl_account,cost_center:i.body.cost_center,internal_order:i.body.internal_order,taxable_amount:i.body.taxable_amount,adjustment:i.body.adjustment,amount:i.body.amount,tcs:i.body.tcs,tds_per:i.body.tds_per,tds_tot_amt:i.body.tds_tot_amt,discount_per:i.body.discount_per,total_discount_amount:i.body.total_discount_amount,cgst_tot_amt:i.body.cgst_tot_amt,sgst_tot_amt:i.body.sgst_tot_amt,igst_tot_amt:i.body.igst_tot_amt});await cds.tx(t).run(INSERT.into(n).entries(e))}return t}catch(o){t.error(500,o.message)}});var $=true;this.before("READ",a,async t=>{try{if($){let o=t.params[0].invoice_no;console.log(o);const e=[];const n=await h.post(`/dev/fetch-invoice?invoice_no=${o}&userid=einvoiceportal@gmail.com&edit=X`);cds.tx(t).run(DELETE(a));const i=n.body.items;i.forEach(t=>{e.push({invoice_no:n.body.invoice_no,material:t.material,material_desc:t.material_desc,hsn_code:t.hsn_code,item_no:t.item_no,quantity:t.quantity,amt_per_unit:t.amt_per_unit,discount:t.discount,gst_per:t.gst_per,sgst_per:`SGST:${t.sgst_per}`,cgst_per:`CGST:${t.cgst_per}`,igst_per:`IGST:${t.igst_per}`,taxable_amount:t.taxable_amount,tax_value_amount:t.tax_value_amount,sgst_amount:`SGST:${t.sgst_amount}`,cgst_amount:`CGST:${t.cgst_amount}`,igst_amount:`IGST:${t.igst_amount}`,amount:t.amount,bigst_per:t.sgst_amount===0?true:false})});await cds.tx(t).run(INSERT.into(a).entries(e))}return t}catch(o){t.error(500,o.message)}});S=true;this.before("READ",o,async t=>{S=true;try{var e=false;const n=await SELECT.from(o);invoiceNo1=n[0].invoice_no;if(t.params[0].invoice_no!=null){cds.tx(t).run(DELETE(o));var e=true;const n=t.params[0].invoice_no;const a=`/dev/fetch-invoice?invoice_no=${n}&userid=einvoiceportal@gmail.com&edit=X`;const i=await h.post(a);const s=i.body;const _=[];_.push({invoice_no:i.body.invoice_no,INVOICE_FILE:"Open",payment_terms:i.body.payment_terms,irn:i.body.irn,ref_po_num:i.body.ref_po_num,gstin:i.body.gstin,doc_type_desc:i.body.doc_type_desc,user_invoice_id:i.body.user_invoice_id,invoice_date:i.body.invoice_date,posting_date:i.body.posting_date,baseline_date:i.body.baseline_date,supplier_id:i.body.supplier_id,payment_method:i.body.payment_method,company_code:i.body.company_code,currency:i.body.currency,department_name:i.body.department_name,gl_account:i.body.gl_account,cost_center:i.body.cost_center,internal_order:i.body.internal_order,taxable_amount:i.body.taxable_amount,adjustment:i.body.adjustment,amount:i.body.amount,tcs:i.body.tcs,tds_per:i.body.tds_per,tds_tot_amt:i.body.tds_tot_amt,discount_per:i.body.discount_per,total_discount_amount:i.body.total_discount_amount,cgst_tot_amt:i.body.cgst_tot_amt,sgst_tot_amt:i.body.sgst_tot_amt,igst_tot_amt:i.body.igst_tot_amt,file_link:i.body.files[0]?.file_link||"NA",totaltaxamount:(()=>{if(i.body.igst_tot_amt===0){return`CGST: ${i.body.cgst_tot_amt}, SGST: ${i.body.sgst_tot_amt}`}else{return`IGST: ${i.body.igst_tot_amt}`}})()});await cds.tx(t).run(INSERT.into(o).entries(_))}var e=false;return t}catch(n){if(e){t.error(500,n.message)}try{var e=false;const n=await SELECT.from(o);invoiceNo1=n[0].invoice_no;if(t.query.SELECT.where[2].val!=null){cds.tx(t).run(DELETE(o));var e=true;const n=t.query.SELECT.where[2].val;const a=`/dev/fetch-invoice?invoice_no=${n}&userid=einvoiceportal@gmail.com&edit=X`;const i=await h.post(a);const s=i.body;const _=[];_.push({invoice_no:i.body.invoice_no,INVOICE_FILE:"Open",payment_terms:i.body.payment_terms,irn:i.body.irn,ref_po_num:i.body.ref_po_num,gstin:i.body.gstin,doc_type_desc:i.body.doc_type_desc,user_invoice_id:i.body.user_invoice_id,invoice_date:i.body.invoice_date,posting_date:i.body.posting_date,baseline_date:i.body.baseline_date,supplier_id:i.body.supplier_id,payment_method:i.body.payment_method,company_code:i.body.company_code,currency:i.body.currency,department_name:i.body.department_name,gl_account:i.body.gl_account,cost_center:i.body.cost_center,internal_order:i.body.internal_order,taxable_amount:i.body.taxable_amount,adjustment:i.body.adjustment,amount:i.body.amount,tcs:i.body.tcs,tds_per:i.body.tds_per,tds_tot_amt:i.body.tds_tot_amt,discount_per:i.body.discount_per,total_discount_amount:i.body.total_discount_amount,cgst_tot_amt:i.body.cgst_tot_amt,sgst_tot_amt:i.body.sgst_tot_amt,igst_tot_amt:i.body.igst_tot_amt,file_link:i.body.files[0]?.file_link||"NA",file_link:i.body.files[0]?.file_link||"NA",totaltaxamount:(()=>{if(i.body.igst_tot_amt===0){return`CGST: ${i.body.cgst_tot_amt}, SGST: ${i.body.sgst_tot_amt}`}else{return`IGST: ${i.body.igst_tot_amt}`}})()});await cds.tx(t).run(INSERT.into(o).entries(_))}var e=false;return t}catch(n){if(e){t.error(500,n.message)}try{if(S){cds.tx(t).run(DELETE(o));const e=await h.get("/dev/fetch-invoice?tabname=rejected&pageno=1&nooflines=10&userid=einvoiceportal@gmail.com");const n=e.body.invoices;const a=[];n.forEach(t=>{a.push({INVOICE_FILE:t.invoice_files.length||"NA",invoice_no:t.invoice_no,user_invoice_id:t.user_invoice_id,supplier_name:t.supplier_name||"NA",invoice_date:t.invoice_date,working_person:t.working_person,modified_date:t.modified_date})});await cds.tx(t).run(INSERT.into(o).entries(a))}return t}catch(o){t.error(500,o.message)}}}});var N=true;this.before("READ",e,async t=>{try{if(N){let o=t.params[0].invoice_no;console.log(o);const n=[];const a=await h.post(`/dev/fetch-invoice?invoice_no=${o}&userid=einvoiceportal@gmail.com&edit=X`);cds.tx(t).run(DELETE(e));n.push({invoice_no:a.body.invoice_no,payment_terms:a.body.payment_terms,irn:a.body.irn,ref_po_num:a.body.ref_po_num,gstin:a.body.gstin,doc_type_desc:a.body.doc_type_desc,user_invoice_id:a.body.user_invoice_id,invoice_date:a.body.invoice_date,posting_date:a.body.posting_date,baseline_date:a.body.baseline_date,supplier_id:a.body.supplier_id,payment_method:a.body.payment_method,company_code:a.body.company_code,currency:a.body.currency,department_name:a.body.department_name,gl_account:a.body.gl_account,cost_center:a.body.cost_center,internal_order:a.body.internal_order,taxable_amount:a.body.taxable_amount,adjustment:a.body.adjustment,amount:a.body.amount,tcs:a.body.tcs,tds_per:a.body.tds_per,tds_tot_amt:a.body.tds_tot_amt,discount_per:a.body.discount_per,total_discount_amount:a.body.total_discount_amount,cgst_tot_amt:a.body.cgst_tot_amt,sgst_tot_amt:a.body.sgst_tot_amt});await cds.tx(t).run(INSERT.into(e).entries(n))}return t}catch(o){t.error(500,o.message)}});var L=true;this.before("READ",i,async t=>{try{if(L){let o=t.params[0].invoice_no;console.log(o);const e=[];const n=await h.post(`/dev/fetch-invoice?invoice_no=${o}&userid=einvoiceportal@gmail.com&edit=X`);cds.tx(t).run(DELETE(i));const a=n.body.items;a.forEach(t=>{e.push({invoice_no:n.body.invoice_no,material:t.material,material_desc:t.material_desc,hsn_code:t.hsn_code,item_no:t.item_no,quantity:t.quantity,amt_per_unit:t.amt_per_unit,discount:t.discount,gst_per:t.gst_per,sgst_per:`SGST:${t.sgst_per}`,cgst_per:`CGST:${t.cgst_per}`,igst_per:`IGST:${t.igst_per}`,taxable_amount:t.taxable_amount,tax_value_amount:t.tax_value_amount,sgst_amount:`SGST:${t.sgst_amount}`,cgst_amount:`CGST:${t.cgst_amount}`,igst_amount:`IGST:${t.igst_amount}`,amount:t.amount,bigst_per:t.sgst_amount===0?true:false})});await cds.tx(t).run(INSERT.into(i).entries(e))}return t}catch(o){t.error(500,o.message)}});var D=true;this.before("READ",p,async t=>{try{if(D){let o=1;const e=[];while(true){const n=await h.post(`/dev/fetch-invoice?userid=einvoiceportal@gmail.com&tabname=inapproval&pageno=${o}&nooflines=50`);cds.tx(t).run(DELETE(p));const a=n.body.invoices;if(a.length==0){break}a.forEach(t=>{e.push({invoice_no:t.invoice_no,user_invoice_id:t.user_invoice_id,supplier_name:t.supplier_name||"NA",invoice_date:t.invoice_date,working_person:t.working_person,modified_date:t.modified_date})});o++}await cds.tx(t).run(INSERT.into(p).entries(e));D=false}return t}catch(o){t.error(500,o.message)}});var G=true;this.before("READ",l,async t=>{try{if(G){let o=t.params[0].invoice_no;console.log(o);const e=[];const n=await h.post(`/dev/fetch-invoice?invoice_no=${o}&userid=einvoiceportal@gmail.com&edit=X`);cds.tx(t).run(DELETE(l));e.push({invoice_no:n.body.invoice_no,payment_terms:n.body.payment_terms,irn:n.body.irn,ref_po_num:n.body.ref_po_num,gstin:n.body.gstin,doc_type_desc:n.body.doc_type_desc,user_invoice_id:n.body.user_invoice_id,invoice_date:n.body.invoice_date,posting_date:n.body.posting_date,baseline_date:n.body.baseline_date,supplier_id:n.body.supplier_id,payment_method:n.body.payment_method,company_code:n.body.company_code,currency:n.body.currency,department_name:n.body.department_name,gl_account:n.body.gl_account,cost_center:n.body.cost_center,internal_order:n.body.internal_order,taxable_amount:n.body.taxable_amount,adjustment:n.body.adjustment,amount:n.body.amount,tcs:n.body.tcs,tds_per:n.body.tds_per,tds_tot_amt:n.body.tds_tot_amt,discount_per:n.body.discount_per,total_discount_amount:n.body.total_discount_amount,cgst_tot_amt:n.body.cgst_tot_amt,sgst_tot_amt:n.body.sgst_tot_amt});await cds.tx(t).run(INSERT.into(l).entries(e))}return t}catch(o){t.error(500,o.message)}});var C=true;this.before("READ",s,async t=>{try{if(C){var o=t.params[0].invoice_no;console.log(o);const e=[];const n=await h.post(`/dev/fetch-invoice?invoice_no=${o}&userid=einvoiceportal@gmail.com&edit=X`);cds.tx(t).run(DELETE(s));const a=n.body.items;a.forEach(t=>{e.push({invoice_no:n.body.invoice_no,material:t.material,material_desc:t.material_desc,hsn_code:t.hsn_code,item_no:t.item_no,quantity:t.quantity,amt_per_unit:t.amt_per_unit,discount:t.discount,gst_per:t.gst_per,sgst_per:`SGST:${t.sgst_per}`,cgst_per:`CGST:${t.cgst_per}`,igst_per:`IGST:${t.igst_per}`,taxable_amount:t.taxable_amount,tax_value_amount:t.tax_value_amount,sgst_amount:`SGST:${t.sgst_amount}`,cgst_amount:`CGST:${t.cgst_amount}`,igst_amount:`IGST:${t.igst_amount}`,amount:t.amount,bigst_per:t.sgst_amount===0?true:false})});await cds.tx(t).run(INSERT.into(s).entries(e))}return t}catch(o){t.error(500,o.message)}});var R=true;this.before("READ",d,async t=>{R=true;try{var o=false;const e=await SELECT.from(d);invoiceNo1=e[0].invoice_no;if(t.params[0].invoice_no!=null){cds.tx(t).run(DELETE(d));var o=true;const e=t.params[0].invoice_no;const n=`/dev/fetch-invoice?invoice_no=${e}&userid=einvoiceportal@gmail.com&edit=X`;const a=await h.post(n);const i=a.body;const s=[];s.push({invoice_no:a.body.invoice_no,INVOICE_FILE:"Open",payment_terms:a.body.payment_terms,irn:a.body.irn,ref_po_num:a.body.ref_po_num,gstin:a.body.gstin,doc_type_desc:a.body.doc_type_desc,user_invoice_id:a.body.user_invoice_id,invoice_date:a.body.invoice_date,posting_date:a.body.posting_date,baseline_date:a.body.baseline_date,supplier_id:a.body.supplier_id,payment_method:a.body.payment_method,company_code:a.body.company_code,currency:a.body.currency,department_name:a.body.department_name,gl_account:a.body.gl_account,cost_center:a.body.cost_center,internal_order:a.body.internal_order,taxable_amount:a.body.taxable_amount,adjustment:a.body.adjustment,amount:a.body.amount,tcs:a.body.tcs,tds_per:a.body.tds_per,tds_tot_amt:a.body.tds_tot_amt,discount_per:a.body.discount_per,total_discount_amount:a.body.total_discount_amount,cgst_tot_amt:a.body.cgst_tot_amt,sgst_tot_amt:a.body.sgst_tot_amt,igst_tot_amt:a.body.igst_tot_amt,file_link:a.body.files[0]?.file_link||"NA",totaltaxamount:(()=>{if(a.body.igst_tot_amt===0){return`CGST: ${a.body.cgst_tot_amt}, SGST: ${a.body.sgst_tot_amt}`}else{return`IGST: ${a.body.igst_tot_amt}`}})()});await cds.tx(t).run(INSERT.into(d).entries(s))}var o=false;return t}catch(e){if(o){t.error(500,e.message)}try{var o=false;if(t.query.SELECT.where[2].val!=null){cds.tx(t).run(DELETE(d));var o=true;const e=t.query.SELECT.where[2].val;const n=`/dev/fetch-invoice?invoice_no=${e}&userid=einvoiceportal@gmail.com&edit=X`;const a=await h.post(n);const i=a.body;const s=[];s.push({invoice_no:a.body.invoice_no,INVOICE_FILE:"Open",payment_terms:a.body.payment_terms,irn:a.body.irn,ref_po_num:a.body.ref_po_num,gstin:a.body.gstin,doc_type_desc:a.body.doc_type_desc,user_invoice_id:a.body.user_invoice_id,invoice_date:a.body.invoice_date,posting_date:a.body.posting_date,baseline_date:a.body.baseline_date,supplier_id:a.body.supplier_id,payment_method:a.body.payment_method,company_code:a.body.company_code,currency:a.body.currency,department_name:a.body.department_name,gl_account:a.body.gl_account,cost_center:a.body.cost_center,internal_order:a.body.internal_order,taxable_amount:a.body.taxable_amount,adjustment:a.body.adjustment,amount:a.body.amount,tcs:a.body.tcs,tds_per:a.body.tds_per,tds_tot_amt:a.body.tds_tot_amt,discount_per:a.body.discount_per,total_discount_amount:a.body.total_discount_amount,cgst_tot_amt:a.body.cgst_tot_amt,sgst_tot_amt:a.body.sgst_tot_amt,igst_tot_amt:a.body.igst_tot_amt,file_link:a.body.files[0]?.file_link||"NA",file_link:a.body.files[0]?.file_link||"NA",totaltaxamount:(()=>{if(a.body.igst_tot_amt===0){return`CGST: ${a.body.cgst_tot_amt}, SGST: ${a.body.sgst_tot_amt}`}else{return`IGST: ${a.body.igst_tot_amt}`}})()});await cds.tx(t).run(INSERT.into(d).entries(s))}var o=false;return t}catch(e){if(o){t.error(500,e.message)}try{if(R){cds.tx(t).run(DELETE(d));const o=await h.get("/dev/fetch-invoice?tabname=inapproval&pageno=1&nooflines=10&userid=einvoiceportal@gmail.com");const e=o.body.invoices;const n=[];e.forEach(t=>{n.push({INVOICE_FILE:t.invoice_files.length||"NA",invoice_no:t.invoice_no,user_invoice_id:t.user_invoice_id,supplier_name:t.supplier_name||"NA",invoice_date:t.invoice_date,working_person:t.working_person,modified_date:t.modified_date})});await cds.tx(t).run(INSERT.into(d).entries(n))}return t}catch(o){t.error(500,o.message)}}}});firstReadInvoiceApproved=true;this.before("READ",v,async t=>{firstReadInvoiceApproved=true;try{var o=false;const e=await SELECT.from(v);invoiceNo1=e[0].invoice_no;if(t.params[0].invoice_no!=null){cds.tx(t).run(DELETE(v));var o=true;const e=t.params[0].invoice_no;const n=`/dev/fetch-invoice?invoice_no=${e}&userid=einvoiceportal@gmail.com&edit=X`;const a=await h.post(n);const i=a.body;const s=[];s.push({invoice_no:a.body.invoice_no,INVOICE_FILE:"Open",payment_terms:a.body.payment_terms,irn:a.body.irn,ref_po_num:a.body.ref_po_num,gstin:a.body.gstin,doc_type_desc:a.body.doc_type_desc,user_invoice_id:a.body.user_invoice_id,invoice_date:a.body.invoice_date,posting_date:a.body.posting_date,baseline_date:a.body.baseline_date,supplier_id:a.body.supplier_id,payment_method:a.body.payment_method,company_code:a.body.company_code,currency:a.body.currency,department_name:a.body.department_name,gl_account:a.body.gl_account,cost_center:a.body.cost_center,internal_order:a.body.internal_order,taxable_amount:a.body.taxable_amount,adjustment:a.body.adjustment,amount:a.body.amount,tcs:a.body.tcs,tds_per:a.body.tds_per,tds_tot_amt:a.body.tds_tot_amt,discount_per:a.body.discount_per,total_discount_amount:a.body.total_discount_amount,cgst_tot_amt:a.body.cgst_tot_amt,sgst_tot_amt:a.body.sgst_tot_amt,igst_tot_amt:a.body.igst_tot_amt,file_link:a.body.files[0]?.file_link||"NA",totaltaxamount:(()=>{if(a.body.igst_tot_amt===0){return`CGST: ${a.body.cgst_tot_amt}, SGST: ${a.body.sgst_tot_amt}`}else{return`IGST: ${a.body.igst_tot_amt}`}})()});await cds.tx(t).run(INSERT.into(v).entries(s))}var o=false;return t}catch(e){if(o){t.error(500,e.message)}try{var o=false;if(t.query.SELECT.where[2].val!=null){cds.tx(t).run(DELETE(v));var o=true;const e=t.query.SELECT.where[2].val;const n=`/dev/fetch-invoice?invoice_no=${e}&userid=einvoiceportal@gmail.com&edit=X`;const a=await h.post(n);const i=a.body;const s=[];s.push({invoice_no:a.body.invoice_no,INVOICE_FILE:"Open",payment_terms:a.body.payment_terms,irn:a.body.irn,ref_po_num:a.body.ref_po_num,gstin:a.body.gstin,doc_type_desc:a.body.doc_type_desc,user_invoice_id:a.body.user_invoice_id,invoice_date:a.body.invoice_date,posting_date:a.body.posting_date,baseline_date:a.body.baseline_date,supplier_id:a.body.supplier_id,payment_method:a.body.payment_method,company_code:a.body.company_code,currency:a.body.currency,department_name:a.body.department_name,gl_account:a.body.gl_account,cost_center:a.body.cost_center,internal_order:a.body.internal_order,taxable_amount:a.body.taxable_amount,adjustment:a.body.adjustment,amount:a.body.amount,tcs:a.body.tcs,tds_per:a.body.tds_per,tds_tot_amt:a.body.tds_tot_amt,discount_per:a.body.discount_per,total_discount_amount:a.body.total_discount_amount,cgst_tot_amt:a.body.cgst_tot_amt,sgst_tot_amt:a.body.sgst_tot_amt,igst_tot_amt:a.body.igst_tot_amt,file_link:a.body.files[0]?.file_link||"NA",file_link:a.body.files[0]?.file_link||"NA",totaltaxamount:(()=>{if(a.body.igst_tot_amt===0){return`CGST: ${a.body.cgst_tot_amt}, SGST: ${a.body.sgst_tot_amt}`}else{return`IGST: ${a.body.igst_tot_amt}`}})()});await cds.tx(t).run(INSERT.into(v).entries(s))}var o=false;return t}catch(e){if(o){t.error(500,e.message)}try{if(firstReadInvoiceApproved){cds.tx(t).run(DELETE(v));const o=await h.get("/dev/fetch-invoice?tabname=rejected&pageno=1&nooflines=10&userid=einvoiceportal@gmail.com");const e=o.body.invoices;const n=[];e.forEach(t=>{n.push({INVOICE_FILE:t.invoice_files.length||"NA",invoice_no:t.invoice_no,user_invoice_id:t.user_invoice_id,supplier_name:t.supplier_name||"NA",invoice_date:t.invoice_date,working_person:t.working_person,modified_date:t.modified_date})});await cds.tx(t).run(INSERT.into(v).entries(n))}return t}catch(o){t.error(500,o.message)}}}});var k=true;this.before("READ",g,async t=>{try{if(k){let o=t.params[0].invoice_no;console.log(o);const e=[];const n=await h.post(`/dev/fetch-invoice?invoice_no=${o}&userid=einvoiceportal@gmail.com&edit=X`);cds.tx(t).run(DELETE(g));e.push({invoice_no:n.body.invoice_no,payment_terms:n.body.payment_terms,irn:n.body.irn,ref_po_num:n.body.ref_po_num,gstin:n.body.gstin,doc_type_desc:n.body.doc_type_desc,user_invoice_id:n.body.user_invoice_id,invoice_date:n.body.invoice_date,posting_date:n.body.posting_date,baseline_date:n.body.baseline_date,supplier_id:n.body.supplier_id,payment_method:n.body.payment_method,company_code:n.body.company_code,currency:n.body.currency,department_name:n.body.department_name,gl_account:n.body.gl_account,cost_center:n.body.cost_center,internal_order:n.body.internal_order,taxable_amount:n.body.taxable_amount,adjustment:n.body.adjustment,amount:n.body.amount,tcs:n.body.tcs,tds_per:n.body.tds_per,tds_tot_amt:n.body.tds_tot_amt,discount_per:n.body.discount_per,total_discount_amount:n.body.total_discount_amount,cgst_tot_amt:n.body.cgst_tot_amt,sgst_tot_amt:n.body.sgst_tot_amt});await cds.tx(t).run(INSERT.into(g).entries(e))}return t}catch(o){t.error(500,o.message)}});var A=true;this.before("READ",_,async t=>{try{if(A){let o=t.params[0].invoice_no;console.log(o);const e=[];const n=await h.post(`/dev/fetch-invoice?invoice_no=${o}&userid=einvoiceportal@gmail.com&edit=X`);cds.tx(t).run(DELETE(_));const a=n.body.items;a.forEach(t=>{e.push({invoice_no:n.body.invoice_no,material:t.material,material_desc:t.material_desc,hsn_code:t.hsn_code,item_no:t.item_no,quantity:t.quantity,amt_per_unit:t.amt_per_unit,discount:t.discount,gst_per:t.gst_per,sgst_per:`SGST:${t.sgst_per}`,cgst_per:`CGST:${t.cgst_per}`,igst_per:`IGST:${t.igst_per}`,taxable_amount:t.taxable_amount,tax_value_amount:t.tax_value_amount,sgst_amount:`SGST:${t.sgst_amount}`,cgst_amount:`CGST:${t.cgst_amount}`,igst_amount:`IGST:${t.igst_amount}`,amount:t.amount,bigst_per:t.sgst_amount===0?true:false})});await cds.tx(t).run(INSERT.into(_).entries(e))}return t}catch(o){t.error(500,o.message)}});var O=true;this.before("READ",r,async t=>{try{if(O){const o=[];const e=await h.get(`/dev/search-help?master_id=12`);cds.tx(t).run(DELETE(r));const n=e.body.search_help;n.forEach(t=>{o.push({code:t.code,description:t.description})});await cds.tx(t).run(INSERT.into(r).entries(o));O=false}return t}catch(o){t.error(500,o.message)}});var j=true;this.before("READ",c,async t=>{try{if(j){const o=[];const e=await h.get(`/dev/report?document_type=invoice-help?master_id=12`);cds.tx(t).run(DELETE(c));const n=e.body.search_help;n.forEach(t=>{o.push({code:t.code,description:t.description})});await cds.tx(t).run(INSERT.into(c).entries(o));j=false}return t}catch(o){t.error(500,o.message)}});var X=true;this.before("READ",E,async t=>{try{if(X){const o=[];const e=await h.get(`/dev/dropdown?drop_key=material_gst_per\n                `);cds.tx(t).run(DELETE(E));const n=e.body;n.forEach(t=>{o.push({value2:t.value2})});await cds.tx(t).run(INSERT.into(E).entries(o));X=false}return t}catch(o){t.error(500,o.message)}});var q=true;this.before("READ",f,async t=>{try{if(q){const o=[];const e=await h.get(`/dev/dropdown?drop_key=vendor_payment_terms`);cds.tx(t).run(DELETE(f));const n=e.body;n.forEach(t=>{o.push({drop_key:t.drop_key,table_key:t.table_key,value2:t.value2,value3:t.value3,value4:t.value4})});await cds.tx(t).run(INSERT.into(f).entries(o));q=false}return t}catch(o){t.error(500,o.message)}});var F=true;this.before("READ",m,async t=>{try{if(F){const o=[];const e=await h.get(`/dev/dropdown?drop_key=vendor_tds`);cds.tx(t).run(DELETE(m));const n=e.body;n.forEach(t=>{o.push({drop_key:t.drop_key,table_key:t.table_key,value2:t.value2,value3:t.value3,value4:t.value4})});await cds.tx(t).run(INSERT.into(m).entries(o));F=false}return t}catch(o){t.error(500,o.message)}});this.on("getOrderDefaults",async t=>({INVOICE_FILE:"Open"}));this.on("setOrderProcessing",t,async o=>{await cds.update(t,o.params[0].ID).set({INVOICE_FILE:"In Process"})});this.on("setOrderOpen",t,async o=>{await cds.update(t,o.params[0].ID).set({INVOICE_FILE:"Open"})});this.on("showigst","Invoice1",async o=>{const e=o.params[0].invoice_no;const n=await h.post(`/dev/fetch-invoice?invoice_no=${e}&userid=einvoiceportal@gmail.com&edit=X`);const a=n.body.igst_tot_amt;await cds.update(t).set({totaltaxamount:`IGST:${a}`,bool:false}).where({invoice_no:e})});this.on("showigst","Invoice1.drafts",async o=>{const e=o.params[0].invoice_no;const n=await h.post(`/dev/fetch-invoice?invoice_no=${e}&userid=einvoiceportal@gmail.com&edit=X`);const a=n.body.igst_tot_amt;await cds.update(t.drafts).set({totaltaxamount:`IGST:${a}`,bool:false}).where({invoice_no:e})});this.on("hideigst",t,async o=>{const e=o.params[0].invoice_no;const n=await h.post(`/dev/fetch-invoice?invoice_no=${e}&userid=einvoiceportal@gmail.com&edit=X`);const i=n.body.cgst_tot_amt;const s=n.body.sgst_tot_amt;await cds.update(t,o.params[0].invoice_no).set({totaltaxamount:`CGST:${i} SGST:${s}`,bool:true});await cds.update(a,o.params[0].invoice_no).set({bigst_per:true})});this.on("hideigst",t.drafts,async o=>{const e=o.params[0].invoice_no;const n=await h.post(`/dev/fetch-invoice?invoice_no=${e}&userid=einvoiceportal@gmail.com&edit=X`);const i=n.body.cgst_tot_amt;const s=n.body.sgst_tot_amt;await cds.update(t.drafts,o.params[0].invoice_no).set({totaltaxamount:`CGST:${i} SGST:${s}`,bool:true});await cds.update(a.drafts).set({bigst_per:true}).where({invoice_no:e})});this.on("showigst1",a,async t=>{const o=t.params[1].id;await cds.update(a).set({bigst_per:true}).where({id:o})});this.on("hideigst2",a,async t=>{const o=t.params[1].id;UPDATE(a).set({bigst_per:false}).where({id:o})});this.on("shownpo",t.drafts,async o=>{await cds.update(t.drafts,o.params[0].ID).set({value1:1})});this.on("hidenpo",t.drafts,async o=>{await cds.update(t.drafts,o.params[0].ID).set({value1:7})})});